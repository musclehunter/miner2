# 採掘人 - システムアーキテクチャ

## 全体構成

「採掘人」は以下の技術スタックで構築されています：

- **サーバーサイド**: Go言語 + Gin Webフレームワーク
- **クライアントサイド**: Vue.js
- **データストア**: MySQL, Redis
- **開発環境**: Docker Compose

## アーキテクチャ概要

### バックエンド (Go/Gin)

バックエンドはRESTful APIを提供するマイクロサービスとして実装されています。

```
backend/
│   simple_server.go  # エントリーポイント
│   handlers/         # ハンドラー関数
│   ├── auth.go       # 認証関連ハンドラー
│   ├── game.go       # ゲーム関連ハンドラー
│   ├── admin.go      # 管理者用ハンドラー
│   └── pending_users.go # 未確認ユーザー管理
│   models/           # データモデル
│   database/         # データベース関連
│   cache/            # Redisキャッシュ関連
└── mail/             # メール送信関連
```

#### 主要コンポーネント

1. **認証システム**
   - JWTベースのトークン認証
   - ユーザー登録とメール確認フロー
   - 管理者認証と権限管理

2. **ゲームロジック**
   - 町と鉱石のデータ管理
   - プレイヤーの拠点と労働者管理
   - 鉱石採掘と市場での取引

3. **データ永続化**
   - MySQLでのゲームデータ永続化
   - Redisでのキャッシュと一時データ管理

### フロントエンド (Vue.js)

フロントエンドはVue.jsのSPAとして実装され、バックエンドAPIと通信します。

```
frontend/
├── public/           # 静的アセット
└── src/              # ソースコード
    ├── assets/       # アセット
    ├── components/   # コンポーネント
    │   ├── auth/     # 認証関連コンポーネント
    │   ├── game/     # ゲーム関連コンポーネント
    │   └── layout/   # レイアウト関連コンポーネント
    ├── views/        # ビュー
    ├── router/       # ルーター
    ├── store/        # Vuex ストア
    └── App.vue       # ルートコンポーネント
```

#### 主要コンポーネント

1. **認証モジュール**
   - ログインとサインアップフォーム
   - 認証状態管理 (Vuex)
   - ナビゲーションガード

2. **ゲーム画面**
   - ワールドマップ
   - 拠点管理
   - 市場取引
   - 労働者管理

3. **共通UI要素**
   - グローバルナビゲーションメニュー
   - 通知システム
   - ローディングインジケーター

## データフロー

1. ユーザーがフロントエンドで操作を実行
2. Vue.jsがHTTP経由でバックエンドAPIにリクエスト送信
3. バックエンドがリクエストを処理（認証確認、ビジネスロジック実行）
4. 必要に応じてデータベースやRedisと通信
5. 結果をJSON形式でフロントエンドに返す
6. フロントエンドがUIを更新

## セキュリティ

- すべての認証済みリクエストはJWTトークンを使用
- パスワードはbcryptでハッシュ化して保存
- CORS設定で許可されたオリジンからのリクエストのみ受け付け
- ナビゲーションガードによる保護されたルートの制御

## 拡張性

システムは将来的な機能追加を考慮して設計されています：

- マイクロサービスアーキテクチャによる水平スケーリング
- モジュール化されたコードベースで新機能の追加が容易
- Docker Composeによる環境の再現性確保
